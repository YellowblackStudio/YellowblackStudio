<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>SupPost</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; background:#f5f5f5; padding:20px }
    #app { max-width:500px; margin:auto; background:white; padding:20px; border-radius:10px }
    textarea { width:100%; height:80px }
    button { margin-top:10px }
    .post { border-bottom:1px solid #ddd; padding:10px 0 }
  </style>
</head>
<body>
  <div id="app">
    <h2>SupPost</h2>

    <div id="auth">
      <input id="email" placeholder="email"><br><br>
      <input id="password" type="password" placeholder="senha"><br><br>
      <button onclick="login()">Login / Registrar</button>
    </div>

    <div id="main" style="display:none">
      <textarea id="content" placeholder="O que você está pensando?"></textarea>
      <button onclick="postar()">Postar</button>
      <h3>Posts</h3>
      <div id="posts"></div>
    </div>
  </div>

<script>\n  // FIX: não sobrescrever o objeto global supabase\n
  const supabaseClient = supabase.createClient(
    'SUA_SUPABASE_URL',
    'SUA_PUBLIC_ANON_KEY'
  )

  async function login() {
    const email = email.value
    const password = password.value
    const { error } = await supabaseClient.auth.signInWithPassword({ email, password })
    if (error) {
      await supabaseClient.auth.signUp({ email, password })
    }
    init()
  }

  async function init() {
    document.getElementById('auth').style.display = 'none'
    document.getElementById('main').style.display = 'block'
    carregarPosts()
  }

  async function postar() {
    const user = (await supabaseClient.auth.getUser()).data.user
    await supabaseClient.from('posts').insert({
      user_id: user.id,
      content: content.value
    })
    content.value = ''
    carregarPosts()
  }

  async function carregarPosts() {
    const { data } = await supabase
      .from('posts')
      .select('*')
      .order('created_at', { ascending: false })

    posts.innerHTML = ''
    data.forEach(p => {
      posts.innerHTML += `<div class="post">${p.content}</div>`
    })
  }
</script>
</body>
</html>
